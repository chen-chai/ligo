ext {
    deployType = "jar"
    deployDir = new File(project.buildDir, "/deploy")
}

// 准备部署需要的目录结构
task prepareDeploy(dependsOn: "assemble") {
}

build {
    dependsOn "prepareDeploy"
}

// 执行 prepareDeploy task
prepareDeploy << {
    if (deployType == "jar") {
        copy {
            from configurations.runtime
            into "$deployDir/lib"
        }
        copy {
            with jar
            into deployDir
        }
    } else if (deployType == "war") {
        copy {
            into deployDir
            with war
            exclude "WEB-INF/empty"
        }
    } else {
        println "Unsupported deploy type: $deployType"
    }
}

// 配置 prepareDeploy task：deployType 可以有 war 和 jar两种类型.
/*
prepareDeploy {
    deployType = "war"
}
*/

